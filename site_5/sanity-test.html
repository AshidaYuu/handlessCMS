<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanityæ¥ç¶šãƒ†ã‚¹ãƒˆ</title>
</head>
<body>
    <h1>Sanity CMSæ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–fetchç‰ˆï¼‰</h1>
    
    <div id="status">ãƒ†ã‚¹ãƒˆä¸­...</div>
    <div id="data"></div>
    
    <script>
        // Sanityè¨­å®š
        const sanityConfig = {
            projectId: 'rt90f87e',
            dataset: 'production',
            apiVersion: '2024-01-01',
            useCdn: true
        };
        
        console.log('Sanity Config:', sanityConfig);
        
        // ãƒã‚¤ãƒ†ã‚£ãƒ–fetch APIã‚’ä½¿ç”¨ã—ã¦Sanityã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
        async function fetchFromSanity(query) {
            const url = `https://${sanityConfig.projectId}.api.sanity.io/v${sanityConfig.apiVersion}/data/query/${sanityConfig.dataset}`;
            const encodedQuery = encodeURIComponent(query);
            
            console.log('ğŸ“¡ URL:', `${url}?query=${encodedQuery}`);
            
            const response = await fetch(`${url}?query=${encodedQuery}`);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            return data.result;
        }
        
        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function testSanityConnection() {
            const statusEl = document.getElementById('status');
            const dataEl = document.getElementById('data');
            
            try {
                statusEl.innerHTML = 'ğŸ“¡ Sanity APIã«ç›´æ¥æ¥ç¶šä¸­...';
                
                // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ã‚¨ãƒªã§ãƒ†ã‚¹ãƒˆ
                const query = '*[_type == "post"]{title, publishedAt, _id}';
                console.log('Query:', query);
                
                const posts = await fetchFromSanity(query);
                console.log('Posts:', posts);
                
                statusEl.innerHTML = `âœ… æ¥ç¶šæˆåŠŸï¼æŠ•ç¨¿æ•°: ${posts.length}`;
                
                if (posts.length > 0) {
                    dataEl.innerHTML = '<h3>å–å¾—ã—ãŸæŠ•ç¨¿:</h3>' + 
                        posts.map(post => `
                            <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                                <strong>ID:</strong> ${post._id}<br>
                                <strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${post.title || 'æœªè¨­å®š'}<br>
                                <strong>å…¬é–‹æ—¥:</strong> ${post.publishedAt || 'æœªè¨­å®š'}
                            </div>
                        `).join('');
                } else {
                    dataEl.innerHTML = '<p>æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚Sanity Studioã§æŠ•ç¨¿ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>';
                }
                
            } catch (error) {
                console.error('Sanity Error:', error);
                statusEl.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                dataEl.innerHTML = `<pre style="color: red;">${error.stack}</pre>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', testSanityConnection);
    </script>
</body>
</html>